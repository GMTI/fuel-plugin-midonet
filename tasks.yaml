# Define the tasks to create midonet
- id: install_nsdb_dependencies
  role: [nsdb]
  stage: pre_deployment/6001
  required_for: [pre_deployment_end]
  type: shell
  parameters:
    cmd: ./install_nsdb_dependencies.sh
    timeout: 360
- id: install_controller_dependencies
  role: [primary-controller, controller]
  stage: pre_deployment/6001
  required_for: [pre_deployment_end]
  type: shell
  parameters:
    cmd: ./install_controller_dependencies.sh
    timeout: 360
- id: cassandra_and_zookeeper
  role: [nsdb]
  stage: post_deployment/6001
  required_for: [deploy_end]
  type: puppet
  parameters:
    puppet_manifest: nsdb.pp
    puppet_modules: "puppet/:/etc/puppet/modules/"
    timeout: 360
- id: enable_ip_forward
  role: [nsdb, compute]
  stage: post_deployment/4001
  required_for: [post_deployment_end]
  type: puppet
  parameters:
    puppet_manifest: enable_ip_forward.pp
    puppet_modules: "puppet/:/etc/puppet/modules/"
    timeout: 360
- id: midonet_api
  role: [primary-controller, controller]
  stage: post_deployment/6501
  type: puppet
  parameters:
    puppet_manifest: api.pp
    puppet_modules: "puppet/:/etc/puppet/modules/"
    timeout: 360
  priority: 400
# - role: ['controller','midonet-gw','compute','midonet-simplegw']
#   stage: post_deployment
#   type: puppet
#   parameters:
#     puppet_manifest: midolman_site.pp
#     puppet_modules: "puppet/:/etc/puppet/modules/"
#     timeout: 360
#   priority: 500
# - role: ['controller']
#   stage: post_deployment
#   type: puppet
#   parameters:
#     puppet_manifest: controller_site.pp
#     puppet_modules: "puppet/:/etc/puppet/modules/"
#     timeout: 360
#   priority: 600
# - role: ['controller']
#   stage: post_deployment
#   type: puppet
#   parameters:
#     puppet_manifest: tunnels_site.pp
#     puppet_modules: "puppet/:/etc/puppet/modules/"
#     timeout: 3600
#   priority: 800
# - role: ['compute']
#   stage: post_deployment
#   type: puppet
#   parameters:
#     puppet_manifest: compute_site.pp
#     puppet_modules: "puppet/:/etc/puppet/modules/"
#     timeout: 360
#   priority: 900
# - role: '*'
#   stage: post_deployment
#   type: puppet
#   parameters:
#     puppet_manifest: cleanup.pp
#     puppet_modules: "puppet/:/etc/puppet/modules/"
#     timeout: 360
#   priority: 1000
#
